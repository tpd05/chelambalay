<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ƒê·∫∑c s·∫£n B·∫Øc Giang - K·∫πo ch√® lam b√† L√Ω - S·∫£n ph·∫©m ƒë·∫∑c s·∫£n truy·ªÅn th·ªëng">
    <title>ƒê·∫∑c s·∫£n B·∫Øc Giang - K·∫πo ch√® lam b√† L√Ω</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="public/img/logo.png" alt="K·∫πo ch√® lam b√† L√Ω Logo">
                </div>
                <nav class="nav">
                    <a href="#order-form-card" class="nav-link">ƒê·∫∑t h√†ng</a>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <div class="hero-grid">
                <div class="hero-content">
                    <div class="badge-trust">
                        <i class="fas fa-check-circle"></i> ƒê·∫£m b·∫£o 100% Nguy√™n li·ªáu s·∫°ch
                    </div>
                    <h1 class="hero-title">ƒê·∫∑c s·∫£n B·∫Øc Giang</h1>
                    <h2 class="hero-subtitle">K·∫πo ch√® lam b√† L√Ω - H∆∞∆°ng v·ªã truy·ªÅn th·ªëng</h2>
                    <p class="hero-description">
                        Th·ª©c qu√† qu√™ d√¢n d√£, ng·ªçt thanh v·ªã m·∫≠t m√≠a, th∆°m n·ªìng h∆∞∆°ng g·ª´ng gi√†. 
                        M√≥n qu√† √Ω nghƒ©a t·∫∑ng ng∆∞·ªùi th√¢n, tr·ªçn v·∫πn t√¨nh qu√™ h∆∞∆°ng.
                    </p>
        
                    <ul class="hero-features">
                        <li><i class="fas fa-leaf"></i> Nguy√™n li·ªáu t·ª± nhi√™n, kh√¥ng ch·∫•t b·∫£o qu·∫£n</li>
                        <li><i class="fas fa-history"></i> C√¥ng th·ª©c gia truy·ªÅn h∆°n 30 nƒÉm</li>
                        <li><i class="fas fa-heart"></i> V·ªã ng·ªçt thanh, d·∫ªo th∆°m, kh√¥ng d√≠nh rƒÉng</li>
                        <li><i class="fas fa-shipping-fast"></i> Giao h√†ng to√†n qu·ªëc si√™u t·ªëc</li>
                    </ul>
                    
                    <div class="product-gallery">
                        <div class="gallery-item">
                            <img src="public/img/sp1.jpg" alt="Ch√® lam d·∫ªo th∆°m">
                        </div>
                        <div class="gallery-item">
                            <img src="public/img/sp2.jpg" alt="ƒê√≥ng g√≥i c·∫©n th·∫≠n">
                        </div>
                        <div class="gallery-item">
                            <img src="public/img/sp3.jpg" alt="Qu√† bi·∫øu sang tr·ªçng">
                        </div>
                    </div>
                </div>
        
                <div class="order-form-card" id="order-form-card">
                    <img src="public/img/sale.png" alt="Khuy·∫øn m√£i" class="sale-badge">
                    <div class="price-section">
                        <div class="price-header">∆Øu ƒë√£i h√¥m nay</div>
                        <div class="price-line">
                            <span class="old-price">80.000ƒë</span>
                            <span class="discount-badge">-6,25%</span>
                        </div>
                        <div class="new-price">75.000ƒë<span class="unit">/1kg</span></div>
                    </div>
                    
                    <h3 class="form-title">ƒê·∫∑t h√†ng nhanh</h3>
                    <p class="form-subtitle">ƒêi·ªÅn th√¥ng tin ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n mi·ªÖn ph√≠</p>

                    <form id="orderForm" class="order-form">
                        <div class="form-group">
                            <label><i class="fas fa-box-open"></i> Ch·ªçn lo·∫°i:</label>
                            <div class="product-options">
                                <label class="option-item">
                                    <input type="radio" name="productType" value="500g" data-price="40000" onchange="updatePrice()">
                                    <span class="opt-name">T√∫i 500g</span>
                                    <span class="opt-price">40.000ƒë</span>
                                </label>
                                <label class="option-item selected">
                                    <div class="save-tag">Ti·∫øt ki·ªám</div>
                                    <input type="radio" name="productType" value="1kg" data-price="75000" checked onchange="updatePrice()">
                                    <span class="opt-name">T√∫i 1kg</span>
                                    <span class="opt-price">75.000ƒë</span>
                                </label>
                            </div>
                        </div>
        
                        <div class="form-group">
                            <label for="fullName"><i class="fas fa-user"></i> H·ªç v√† t√™n</label>
                            <input type="text" id="fullName" name="fullName" required placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A" aria-required="true">
                        </div>
        
                        <div class="form-group">
                            <label for="phone"><i class="fas fa-phone"></i> S·ªë ƒëi·ªán tho·∫°i</label>
                            <input type="tel" id="phone" name="phone" required placeholder="V√≠ d·ª•: 0981 234 567" pattern="[0-9]{10,11}" aria-required="true">
                        </div>

                        <div class="form-group">
                            <label for="addressDisplay"><i class="fas fa-map-marker-alt"></i> ƒê·ªãa ch·ªâ nh·∫≠n h√†ng</label>
                            <div class="address-input-wrapper" onclick="openAddressModal()">
                                <input type="text" id="addressDisplay" name="addressDisplay" required placeholder="Nh·∫•n ƒë·ªÉ nh·∫≠p ƒë·ªãa ch·ªâ chi ti·∫øt" readonly aria-required="true">
                                <i class="fas fa-edit address-edit-icon"></i>
                            </div>
                            <input type="hidden" id="fullAddress" name="fullAddress">
                        </div>

                        <div class="form-group" id="shippingServicesGroup" style="display: none;">
                            <label><i class="fas fa-shipping-fast"></i> Ch·ªçn g√≥i v·∫≠n chuy·ªÉn</label>
                            <div class="shipping-provider-info">
                                <i class="fas fa-truck" style="color: var(--primary-orange);"></i>
                                <span>ƒê∆°n v·ªã v·∫≠n chuy·ªÉn: <strong style="color: #d32f2f;">Viettel Post</strong></span>
                            </div>
                            <div id="shippingServicesList" class="shipping-services-list">
                                <!-- Services will be loaded here -->
                            </div>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-weight-hanging"></i> S·ªë l∆∞·ª£ng (t√∫i)</label>
                            <div class="quantity-control">
                                <button type="button" class="qty-btn" onclick="updateQuantity(-1)">-</button>
                                <input type="number" id="quantity" name="quantity" value="1" min="1" readonly>
                                <button type="button" class="qty-btn" onclick="updateQuantity(1)">+</button>
                            </div>
                        </div>

                        <div class="payment-method">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Thanh to√°n khi nh·∫≠n h√†ng</span>
                        </div>

                        <div class="total-price-display">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Ti·ªÅn h√†ng:</span>
                                <span id="productPrice">75.000ƒë</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;" id="shippingFeeRow" style="display: none;">
                                <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                                <span id="shippingFee" style="color: var(--primary-orange); font-weight: 600;">0ƒë</span>
                            </div>
                            <div style="border-top: 2px dashed #e2e8f0; padding-top: 0.5rem; margin-top: 0.5rem; display: flex; justify-content: space-between;">
                                <span style="font-weight: 700;">T·ªïng c·ªông:</span>
                                <span id="totalPrice" style="font-size: 1.5rem; font-weight: 800; color: var(--primary-orange);">75.000ƒë</span>
                            </div>
                        </div>
                        
                        <div class="shipping-note" id="shippingNote">
                            <i class="fas fa-truck"></i> Vui l√≤ng ch·ªçn g√≥i v·∫≠n chuy·ªÉn ƒë·ªÉ t√≠nh t·ªïng ti·ªÅn
                        </div>
        
                        <button type="submit" class="btn btn-primary btn-block btn-pulse" id="submitBtn" disabled>
                            <span class="btn-text">ƒê·∫∂T MUA NGAY</span>
                            <span class="btn-subtext">Ng∆∞·ªùi b√°n s·∫Ω li√™n h·ªá l·∫°i v·ªõi b·∫°n</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="public/img/logo.png" alt="K·∫πo ch√® lam b√† L√Ω Logo">
                </div>
                
                <div class="footer-section">
                    <h4>Li√™n h·ªá ƒë·∫∑t h√†ng</h4>
                    <div class="footer-info">
                        <p>
                            <i class="fab fa-facebook-square"></i>
                            <strong>Facebook:</strong> <a href="https://www.facebook.com/profile.php?id=61585460543021" target="_blank">K·∫πo ch√® lam b√† L√Ω</a>
                        </p>
                        <p>
                            <i class="fas fa-phone-alt"></i>
                            <strong>Hotline/Zalo:</strong> <a href="tel:0981922581">098 192 25 81</a>
                        </p>
                        <p>
                            <i class="fas fa-map-marker-alt"></i>
                            <strong>ƒê·ªãa ch·ªâ:</strong> ƒê·ªìng N·ªôi - Ng·ªçc Thi·ªán - B·∫Øc Ninh
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 K·∫πo ch√® lam b√† L√Ω.</p>
            </div>
        </div>
    </footer>

    <div class="mobile-bottom-bar">
        <a href="tel:0981922581" class="bar-item call">
            <i class="fas fa-phone-volume"></i> G·ªçi ngay
        </a>
        <a href="https://zalo.me/0981922581" target="_blank" class="bar-item zalo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg" alt="Zalo" width="24"> Chat Zalo
        </a>
        <a href="https://www.facebook.com/profile.php?id=61585460543021" target="_blank" class="bar-item facebook">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Facebook_f_logo_%282019%29.svg/640px-Facebook_f_logo_%282019%29.svg.png" alt="Facebook" width="24"> Facebook
        </a>
        <a href="#order-form-card" class="bar-item order">
            <i class="fas fa-shopping-cart"></i> ƒê·∫∑t h√†ng
        </a>
    </div>

    <div class="floating-group">
        <a href="tel:0981922581" class="floating-btn btn-phone" data-tooltip="G·ªçi ngay: 0981.922.581">
            <div class="pulse-ring"></div>
            <i class="fas fa-phone-alt"></i>
        </a>
        <a href="https://zalo.me/0981922581" target="_blank" class="floating-btn btn-zalo" data-tooltip="Chat Zalo">
            <div class="pulse-ring" style="border-color: #0068ff;"></div>
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg" alt="Chat Zalo">
        </a>
        <a href="https://www.facebook.com/profile.php?id=61585460543021" target="_blank" class="floating-btn btn-facebook" data-tooltip="Facebook Page">
            <div class="pulse-ring" style="border-color: #1877f2;"></div>
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Facebook_f_logo_%282019%29.svg/640px-Facebook_f_logo_%282019%29.svg.png" alt="Facebook Page">
        </a>
    </div>

    <div id="toast" class="toast">
        <div class="toast-content">
            <i class="fas fa-check-circle toast-icon"></i>
            <p class="toast-message">ƒê·∫∑t h√†ng th√†nh c√¥ng! Ng∆∞·ªùi b√°n s·∫Ω li√™n h·ªá cho b·∫°n s·ªõm nh·∫•t.</p>
        </div>
    </div>

    <!-- Modal ƒê·ªãa ch·ªâ -->
    <div id="addressModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-map-marker-alt"></i> Nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n h√†ng</h3>
                <button type="button" class="modal-close" onclick="closeAddressModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-form-group">
                    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b; padding: 12px 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: start; gap: 10px;">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 1.2rem; margin-top: 2px;"></i>
                        <div style="flex: 1;">
                            <strong style="color: #92400e; font-size: 0.95rem; display: block; margin-bottom: 4px;">L∆∞u √Ω</strong>
                            <span style="color: #78350f; font-size: 0.9rem; line-height: 1.5;">Vui l√≤ng ch·ªçn ƒë·ªãa ch·ªâ <strong>tr∆∞·ªõc s√°p nh·∫≠p</strong> (ƒë·ªãa ch·ªâ c≈©) ƒë·ªÉ ƒë·∫£m b·∫£o giao h√†ng ch√≠nh x√°c.</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-form-group">
                    <label for="modalProvince"><i class="fas fa-map-marker-alt"></i> T·ªânh/Th√†nh ph·ªë</label>
                    <select id="modalProvince" required>
                        <option value="">-- Ch·ªçn T·ªânh/Th√†nh ph·ªë --</option>
                    </select>
                </div>

                <div class="modal-form-group">
                    <label for="modalDistrict"><i class="fas fa-map-marked-alt"></i> Qu·∫≠n/Huy·ªán</label>
                    <select id="modalDistrict" required disabled>
                        <option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>
                    </select>
                </div>

                <div class="modal-form-group">
                    <label for="modalWard"><i class="fas fa-map-pin"></i> Ph∆∞·ªùng/X√£</label>
                    <select id="modalWard" required disabled>
                        <option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>
                    </select>
                </div>

                <div class="modal-form-group">
                    <label for="modalAddress"><i class="fas fa-home"></i> S·ªë nh√†, T√™n ƒë∆∞·ªùng, T√≤a nh√†</label>
                    <input type="text" id="modalAddress" required placeholder="V√≠ d·ª•: S·ªë 123, ƒê∆∞·ªùng L√°ng, T√≤a nh√† ABC">
                </div>

                <div class="modal-form-group">
                    <div class="map-instruction">
                        <i class="fas fa-info-circle"></i> 
                        <span>Ho·∫∑c ch·ªçn v·ªã tr√≠ tr√™n b·∫£n ƒë·ªì ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn ƒë·ªãa ch·ªâ</span>
                    </div>
                    <div id="map" class="address-map"></div>
                    <div id="mapLoading" class="map-loading">
                        <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i b·∫£n ƒë·ªì...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal btn-cancel" onclick="closeAddressModal()">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
                <button type="button" class="btn-modal btn-confirm" onclick="confirmAddress()">
                    <i class="fas fa-check"></i> X√°c nh·∫≠n
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        // Thay link n√†y b·∫±ng link Web App c·ªßa b·∫°n
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwSpz53UzW1JEqBkwHzk0C5eP72NL-8iiE71TuxdcDoKCYrC-KYR0JFrXSwj48OTHrkIg/exec';
        // API ƒë·ªãa ch·ªâ Vi·ªát Nam (c·∫≠p nh·∫≠t m·ªõi nh·∫•t)
        const PROVINCES_API = 'https://provinces.open-api.vn/api/';
        
        // ƒê·ªãa ch·ªâ g·ª≠i h√†ng: X√£ Ng·ªçc V√¢n - T√¢n Y√™n - B·∫Øc Giang
        const SENDER_INFO = {
            provinceId: 6,  // B·∫Øc Giang
            districtId: 52  // Huy·ªán T√¢n Y√™n
        };

        // --- X·ª¨ L√ù FORM & T√çNH TI·ªÄN ---
        const orderForm = document.getElementById('orderForm');
        const submitBtn = document.getElementById('submitBtn');
        const toast = document.getElementById('toast');
        const qtyInput = document.getElementById('quantity');
        const totalPriceEl = document.getElementById('totalPrice');

        // --- X·ª¨ L√ù ƒê·ªäA CH·ªà ---
        let provincesData = [];
        let districtsData = [];
        let wardsData = [];
        let map = null;
        let marker = null;
        


        
        // Bi·∫øn l∆∞u c√°c g√≥i v·∫≠n chuy·ªÉn
        let shippingServices = [];
        let selectedService = null;

        // T√≠nh ph√≠ ship qua Google Apps Script proxy (tr√°nh CORS)
        async function calculateVTPShipping(receiverAddress, productWeight, productPrice) {
            try {
                console.log('üöÄ ƒêang g·ªçi API t√≠nh ph√≠ ship...', {
                    receiverAddress,
                    productWeight,
                    productPrice
                });
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'calculateShipping',
                        senderAddress: 'X√£ Ng·ªçc V√¢n, T√¢n Y√™n, B·∫Øc Giang',
                        receiverAddress: receiverAddress,
                        productWeight: productWeight,
                        productPrice: productPrice
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                console.log('üì¶ K·∫øt qu·∫£ t·ª´ server:', result);
                
                if (result && result.status === 200 && result.services) {
                    console.log('‚úÖ C√≥ ' + result.services.length + ' g√≥i d·ªãch v·ª•');
                    shippingServices = result.services;
                    return result.services;
                } else {
                    console.error('‚ùå L·ªói t·ª´ Viettel Post:', result.message || 'Kh√¥ng x√°c ƒë·ªãnh');
                    throw new Error(result.message || 'Kh√¥ng th·ªÉ t√≠nh ph√≠ ship');
                }
                
            } catch (error) {
                console.error('‚ùå L·ªói khi g·ªçi API:', error);
                throw error;
            }
        }

        // Kh·ªüi t·∫°o b·∫£n ƒë·ªì OpenStreetMap (Leaflet)
        function initMap() {
            if (map) return;

            setTimeout(() => {
                try {
                    // T·ªça ƒë·ªô trung t√¢m Vi·ªát Nam (H√† N·ªôi)
                    map = L.map('map').setView([21.0285, 105.8542], 13);

                    // Th√™m tile layer t·ª´ OpenStreetMap
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors',
                        maxZoom: 19
                    }).addTo(map);

                    // T·∫°o custom icon m√†u cam
                    const customIcon = L.icon({
                        iconUrl: 'data:image/svg+xml;base64,' + btoa(`
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="42" viewBox="0 0 32 42">
                                <path fill="#f97316" d="M16 0C7.2 0 0 7.2 0 16c0 11.7 16 26 16 26s16-14.3 16-26C32 7.2 24.8 0 16 0z"/>
                                <circle fill="white" cx="16" cy="16" r="6"/>
                            </svg>
                        `),
                        iconSize: [32, 42],
                        iconAnchor: [16, 42],
                        popupAnchor: [0, -42]
                    });

                    // Click v√†o b·∫£n ƒë·ªì ƒë·ªÉ ƒë·∫∑t marker
                    map.on('click', async function(e) {
                        const lat = e.latlng.lat;
                        const lng = e.latlng.lng;

                        // X√≥a marker c≈© n·∫øu c√≥
                        if (marker) {
                            map.removeLayer(marker);
                        }

                        // Th√™m marker m·ªõi
                        marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
                        marker.bindPopup('ƒêang l·∫•y ƒë·ªãa ch·ªâ...').openPopup();

                        // L·∫•y ƒë·ªãa ch·ªâ t·ª´ t·ªça ƒë·ªô
                        await getAddressFromCoords(lat, lng);
                    });

                    // ·∫®n loading
                    document.getElementById('mapLoading').style.display = 'none';
                    console.log('‚úÖ B·∫£n ƒë·ªì OpenStreetMap ƒë√£ kh·ªüi t·∫°o th√†nh c√¥ng (MI·ªÑN PH√ç)');

                    // L·∫•y v·ªã tr√≠ hi·ªán t·∫°i c·ªßa ng∆∞·ªùi d√πng
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                const lat = position.coords.latitude;
                                const lng = position.coords.longitude;
                                map.setView([lat, lng], 15);
                                console.log('üìç ƒê√£ set v·ªã tr√≠ hi·ªán t·∫°i');
                            },
                            function(error) {
                                console.log('‚ö†Ô∏è Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ hi·ªán t·∫°i');
                            }
                        );
                    }
                } catch (error) {
                    console.error('‚ùå L·ªói kh·ªüi t·∫°o map:', error);
                    document.getElementById('mapLoading').innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-exclamation-triangle" style="color: #ef4444; font-size: 2rem;"></i>
                            <p style="margin-top: 10px; color: #dc2626; font-weight: 600;">L·ªói t·∫£i b·∫£n ƒë·ªì</p>
                            <small style="color: #64748b;">${error.message}</small>
                        </div>
                    `;
                }
            }, 300);
        }

        // L·∫•y ƒë·ªãa ch·ªâ t·ª´ t·ªça ƒë·ªô s·ª≠ d·ª•ng Nominatim (OpenStreetMap - MI·ªÑN PH√ç)
        async function getAddressFromCoords(lat, lng) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1&accept-language=vi`,
                    {
                        headers: {
                            'User-Agent': 'ChelambaBaly/1.0'
                        }
                    }
                );
                const data = await response.json();
                
                if (data && data.address) {
                    console.log('üìç ƒê·ªãa ch·ªâ t·ª´ OpenStreetMap:', data);
                    
                    const addr = data.address;
                    
                    // Parse ƒë·ªãa ch·ªâ Vi·ªát Nam
                    // Province: state, province, city
                    let province = addr.state || addr.province || addr.city;
                    
                    // District: county, town, municipality
                    let district = addr.county || addr.town || addr.municipality;
                    
                    // N·∫øu kh√¥ng c√≥ province ho·∫∑c district, th·ª≠ parse t·ª´ display_name
                    if ((!province || !district) && data.display_name) {
                        // Format c√≥ th·ªÉ l√†:
                        // "road, ward, district, province, postcode, country"
                        // "road, ward, province, postcode, country" (thi·∫øu district)
                        const parts = data.display_name.split(',').map(p => p.trim());
                        
                        console.log('üîç Parsing display_name:', parts);
                        
                        // B·ªè "Vi·ªát Nam" v√† postal code (s·ªë)
                        const filteredParts = parts.filter(p => 
                            p !== 'Vi·ªát Nam' && 
                            p !== 'Vietnam' && 
                            !/^\d+$/.test(p)
                        );
                        
                        console.log('üîç Filtered parts:', filteredParts);
                        
                        // Ph·∫ßn cu·ªëi c√πng th∆∞·ªùng l√† province
                        if (!province && filteredParts.length > 0) {
                            province = filteredParts[filteredParts.length - 1];
                        }
                        
                        // T√¨m ward (c√≥ ti·ªÅn t·ªë Ph∆∞·ªùng/X√£/Th·ªã tr·∫•n)
                        const wardIndex = filteredParts.findIndex(p => /^(Ph∆∞·ªùng|X√£|Th·ªã tr·∫•n)\s+/i.test(p));
                        
                        // District n·∫±m gi·ªØa ward v√† province
                        if (!district && wardIndex >= 0 && filteredParts.length > wardIndex + 2) {
                            // C√≥ district gi·ªØa ward v√† province
                            district = filteredParts[wardIndex + 1];
                        }
                    }
                    
                    // Ward: suburb, city_district (n·∫øu b·∫Øt ƒë·∫ßu b·∫±ng Ph∆∞·ªùng/X√£), neighbourhood, village
                    let ward = addr.suburb || addr.neighbourhood || addr.village || addr.hamlet;
                    
                    // N·∫øu city_district b·∫Øt ƒë·∫ßu v·ªõi "Ph∆∞·ªùng/X√£/Th·ªã tr·∫•n" th√¨ ƒë√≥ l√† ward
                    if (!ward && addr.city_district && /^(Ph∆∞·ªùng|X√£|Th·ªã tr·∫•n)\s+/i.test(addr.city_district)) {
                        ward = addr.city_district;
                    }
                    
                    const road = addr.road || addr.street || '';
                    const houseNumber = addr.house_number || '';

                    console.log('üèôÔ∏è T·ªânh:', province);
                    console.log('üèòÔ∏è Huy·ªán:', district);
                    console.log('üè† X√£:', ward);
                    console.log('üõ£Ô∏è ƒê∆∞·ªùng:', road, houseNumber);

                    // T·ª± ƒë·ªông ƒëi·ªÅn v√†o form
                    if (province) {
                        await selectProvinceByName(province);
                    }

                    if (district && province) {
                        setTimeout(async () => {
                            await selectDistrictByName(district);
                        }, 500);
                    }

                    if (ward && district) {
                        setTimeout(async () => {
                            await selectWardByName(ward);
                        }, 1000);
                    }

                    // ƒêi·ªÅn s·ªë nh√† v√† t√™n ƒë∆∞·ªùng
                    const addressDetail = [houseNumber, road].filter(x => x).join(' ');
                    if (addressDetail) {
                        document.getElementById('modalAddress').value = addressDetail;
                    }

                    // C·∫≠p nh·∫≠t popup marker
                    if (marker) {
                        marker.setPopupContent(`
                            <div style="text-align: center; padding: 5px;">
                                <strong style="color: #f97316;">V·ªã tr√≠ ƒë√£ ch·ªçn</strong><br>
                                <small>${data.display_name}</small>
                            </div>
                        `);
                    }
                } else {
                    if (marker) {
                        marker.setPopupContent('Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ t·∫°i v·ªã tr√≠ n√†y');
                    }
                }
            } catch (error) {
                console.error('Error getting address:', error);
                if (marker) {
                    marker.setPopupContent('L·ªói khi l·∫•y ƒë·ªãa ch·ªâ');
                }
            }
        }

        // T√¨m v√† ch·ªçn t·ªânh theo t√™n
        async function selectProvinceByName(name) {
            const provinceSelect = document.getElementById('modalProvince');
            const options = provinceSelect.options;
            
            const normalizedName = name.replace(/^(Th√†nh ph·ªë|T·ªânh)\s+/i, '').toLowerCase();
            
            for (let i = 0; i < options.length; i++) {
                const optionText = options[i].text.replace(/^(Th√†nh ph·ªë|T·ªânh)\s+/i, '').toLowerCase();
                
                if (optionText.includes(normalizedName) || normalizedName.includes(optionText)) {
                    provinceSelect.value = options[i].value;
                    provinceSelect.dispatchEvent(new Event('change'));
                    return true;
                }
            }
            return false;
        }

        // T√¨m v√† ch·ªçn qu·∫≠n/huy·ªán theo t√™n
        async function selectDistrictByName(name) {
            const districtSelect = document.getElementById('modalDistrict');
            
            // ƒê·ª£i district ƒë∆∞·ª£c load xong
            if (districtSelect.options.length <= 1) {
                console.log('‚è≥ ƒêang ƒë·ª£i danh s√°ch huy·ªán ƒë∆∞·ª£c load...');
                await new Promise(resolve => setTimeout(resolve, 800));
            }
            
            const options = districtSelect.options;
            const normalizedName = name.replace(/^(Qu·∫≠n|Huy·ªán|Th√†nh ph·ªë|Th·ªã x√£)\s+/i, '').toLowerCase();
            
            console.log('üîç T√¨m huy·ªán:', normalizedName);
            
            for (let i = 0; i < options.length; i++) {
                const optionText = options[i].text.replace(/^(Qu·∫≠n|Huy·ªán|Th√†nh ph·ªë|Th·ªã x√£)\s+/i, '').toLowerCase();
                
                if (optionText.includes(normalizedName) || normalizedName.includes(optionText)) {
                    districtSelect.value = options[i].value;
                    console.log('‚úÖ ƒê√£ ch·ªçn huy·ªán:', options[i].text);
                    // Trigger change event ƒë·ªÉ load wards
                    districtSelect.dispatchEvent(new Event('change'));
                    return true;
                }
            }
            console.warn('‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y huy·ªán:', name);
            return false;
        }

        // T√¨m v√† ch·ªçn ph∆∞·ªùng/x√£ theo t√™n
        async function selectWardByName(name) {
            const wardSelect = document.getElementById('modalWard');
            
            // ƒê·ª£i ward ƒë∆∞·ª£c load xong
            if (wardSelect.options.length <= 1) {
                console.log('‚è≥ ƒêang ƒë·ª£i danh s√°ch x√£ ƒë∆∞·ª£c load...');
                await new Promise(resolve => setTimeout(resolve, 1200));
            }
            
            const options = wardSelect.options;
            const normalizedName = name.replace(/^(Ph∆∞·ªùng|X√£|Th·ªã tr·∫•n)\s+/i, '').toLowerCase();
            
            console.log('üîç T√¨m x√£:', normalizedName);
            console.log('üìã Danh s√°ch x√£ c√≥:', Array.from(options).slice(1).map(o => o.text).join(', '));
            
            // Th·ª≠ match ch√≠nh x√°c tr∆∞·ªõc
            for (let i = 0; i < options.length; i++) {
                const optionText = options[i].text.replace(/^(Ph∆∞·ªùng|X√£|Th·ªã tr·∫•n)\s+/i, '').toLowerCase();
                
                if (optionText === normalizedName) {
                    wardSelect.value = options[i].value;
                    console.log('‚úÖ ƒê√£ ch·ªçn x√£ (exact match):', options[i].text);
                    return true;
                }
            }
            
            // Th·ª≠ partial match
            for (let i = 0; i < options.length; i++) {
                const optionText = options[i].text.replace(/^(Ph∆∞·ªùng|X√£|Th·ªã tr·∫•n)\s+/i, '').toLowerCase();
                
                if (optionText.includes(normalizedName) || normalizedName.includes(optionText)) {
                    wardSelect.value = options[i].value;
                    console.log('‚úÖ ƒê√£ ch·ªçn x√£ (partial match):', options[i].text);
                    return true;
                }
            }
            
            console.warn('‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y x√£:', name);
            console.warn('üí° G·ª£i √Ω: Vui l√≤ng ch·ªçn th·ªß c√¥ng t·ª´ danh s√°ch');
            return false;
        }

        // Load provinces cho modal khi trang ƒë∆∞·ª£c t·∫£i
        async function loadProvincesModal() {
            try {
                const response = await fetch(PROVINCES_API + 'p/');
                const provinces = await response.json();
                const provinceSelect = document.getElementById('modalProvince');
                provinces.forEach(province => {
                    const option = document.createElement('option');
                    option.value = province.code;
                    option.textContent = province.name;
                    provinceSelect.appendChild(option);
                });
                console.log('‚úÖ ƒê√£ load', provinces.length, 't·ªânh/th√†nh ph·ªë');
            } catch (error) {
                console.error('‚ùå Error loading provinces:', error);
            }
        }

        // Kh·ªüi t·∫°o event listeners v√† load data khi DOM s·∫µn s√†ng
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners cho c√°c dropdown ƒë·ªãa ch·ªâ trong modal
            document.getElementById('modalProvince').addEventListener('change', function() {
                console.log('T·ªânh ƒë∆∞·ª£c ch·ªçn:', this.value);
                if (this.value) {
                    loadDistrictsModal(this.value);
                } else {
                    document.getElementById('modalDistrict').disabled = true;
                    document.getElementById('modalWard').disabled = true;
                }
            });

            document.getElementById('modalDistrict').addEventListener('change', function() {
                console.log('Huy·ªán ƒë∆∞·ª£c ch·ªçn:', this.value);
                if (this.value) {
                    loadWardsModal(this.value);
                } else {
                    document.getElementById('modalWard').disabled = true;
                }
            });

            // Load provinces
            loadProvincesModal();
        });

        // H√†m m·ªü modal
        function openAddressModal() {
            document.getElementById('addressModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Kh·ªüi t·∫°o b·∫£n ƒë·ªì khi m·ªü modal
            if (!map) {
                initMap();
            }
        }

        // H√†m ƒë√≥ng modal
        function closeAddressModal() {
            document.getElementById('addressModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // ƒê√≥ng modal khi click b√™n ngo√†i
        window.onclick = function(event) {
            const modal = document.getElementById('addressModal');
            if (event.target === modal) {
                closeAddressModal();
            }
        }

        // X√°c nh·∫≠n ƒë·ªãa ch·ªâ
        async function confirmAddress() {
            const province = document.getElementById('modalProvince');
            const district = document.getElementById('modalDistrict');
            const ward = document.getElementById('modalWard');
            const address = document.getElementById('modalAddress');

            if (!province.value || !district.value || !ward.value || !address.value.trim()) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªãa ch·ªâ!');
                return;
            }

            const provinceName = province.selectedOptions[0].text;
            const districtName = district.selectedOptions[0].text;
            const wardName = ward.selectedOptions[0].text;
            const addressDetail = address.value;
            const fullAddress = `${addressDetail}, ${wardName}, ${districtName}, ${provinceName}`;

            document.getElementById('addressDisplay').value = fullAddress;
            document.getElementById('fullAddress').value = fullAddress;
            
            closeAddressModal();
            
            // Load shipping services sau khi ƒë√≥ng modal
            await loadShippingServicesAfterAddress();
        }
        
        // Load v√† hi·ªÉn th·ªã c√°c g√≥i v·∫≠n chuy·ªÉn sau khi x√°c nh·∫≠n ƒë·ªãa ch·ªâ
        async function loadShippingServicesAfterAddress() {
            const fullAddress = document.getElementById('fullAddress').value;
            const selectedWeight = document.querySelector('input[name="productType"]:checked').value === '500g' ? 500 : 1000;
            const selectedPrice = document.querySelector('input[name="productType"]:checked').getAttribute('data-price');
            
            if (!fullAddress) {
                return;
            }
            
            const servicesGroup = document.getElementById('shippingServicesGroup');
            const servicesList = document.getElementById('shippingServicesList');
            
            // Scroll ƒë·∫øn ph·∫ßn shipping services
            servicesGroup.style.display = 'block';
            setTimeout(() => {
                servicesGroup.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
            
            // Disable n√∫t ƒë·∫∑t h√†ng khi ƒëang load
            submitBtn.disabled = true;
            
            servicesList.innerHTML = '<div style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i c√°c g√≥i v·∫≠n chuy·ªÉn...</div>';
            
            try {
                console.log('üìç ƒê·ªãa ch·ªâ nh·∫≠n h√†ng:', fullAddress);
                
                const services = await calculateVTPShipping(fullAddress, selectedWeight, parseInt(selectedPrice));
                
                // L·ªçc b·ªè c√°c g√≥i: TMƒêT Nhanh th·ªèa thu·∫≠n (NCOD) v√† H·ªèa t·ªëc th·ªèa thu·∫≠n (VHT)
                const filteredServices = services.filter(service => 
                    service.code !== 'NCOD' && service.code !== 'VHT'
                );
                
                if (filteredServices && filteredServices.length > 0) {
                    servicesList.innerHTML = filteredServices.map((service, index) => `
                        <label class="service-option ${index === 0 ? 'recommended' : ''}">
                            <input type="radio" name="shippingService" value="${index}" onchange="selectShippingService(${index})" ${index === 0 ? 'checked' : ''}>
                            <div class="service-info">
                                <div class="service-header">
                                    <strong>${service.name}</strong>
                                    ${index === 0 ? '<span class="badge-recommended">R·∫ª nh·∫•t</span>' : ''}
                                </div>
                                <div class="service-details">
                                    <span class="service-price">${service.price.toLocaleString('vi-VN')}ƒë</span>
                                    <span class="service-time"><i class="fas fa-clock"></i> ${service.time}</span>
                                </div>
                            </div>
                        </label>
                    `).join('');
                    
                    // C·∫≠p nh·∫≠t shippingServices v·ªõi filtered list
                    shippingServices = filteredServices;
                    
                    // T·ª± ƒë·ªông ch·ªçn g√≥i ƒë·∫ßu ti√™n (r·∫ª nh·∫•t)
                    selectShippingService(0);
                } else {
                    servicesList.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc2626;">Kh√¥ng t√¨m th·∫•y g√≥i v·∫≠n chuy·ªÉn ph√π h·ª£p</div>';
                }
            } catch (error) {
                console.error('L·ªói load services:', error);
                servicesList.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc2626;">L·ªói khi t·∫£i g√≥i v·∫≠n chuy·ªÉn</div>';
            }
        }
        
        // Ch·ªçn g√≥i v·∫≠n chuy·ªÉn
        function selectShippingService(index) {
            selectedService = shippingServices[index];
            console.log('ƒê√£ ch·ªçn g√≥i:', selectedService);
            
            // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
            calculateTotal();
            
            // Enable n√∫t ƒë·∫∑t h√†ng
            submitBtn.disabled = false;
            
            // Hi·ªÉn th·ªã th√¥ng tin g√≥i ƒë√£ ch·ªçn
            const shippingNote = document.getElementById('shippingNote');
            shippingNote.innerHTML = `
                <i class="fas fa-shipping-fast" style="color: var(--success-green);"></i>
                <span><strong>${selectedService.name}</strong> - D·ª± ki·∫øn: ${selectedService.time}</span>
            `;
            shippingNote.style.background = 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)';
            shippingNote.style.color = '#166534';
            shippingNote.style.padding = '12px';
            shippingNote.style.borderRadius = '8px';
        }
        
        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã ph√≠ ship
        function updateShippingDisplay(fee, deliveryTime, isEstimated = false, errorMessage = null, serviceName = null) {
            const shippingNote = document.querySelector('.shipping-note');
            
            if (errorMessage) {
                // Hi·ªÉn th·ªã l·ªói
                shippingNote.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>${errorMessage}</strong>
                `;
                shippingNote.style.background = 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
                shippingNote.style.color = '#991b1b';
                shippingNote.style.padding = '12px';
                shippingNote.style.borderRadius = '8px';
            } else if (fee) {
                // Hi·ªÉn th·ªã ph√≠ ship th√†nh c√¥ng
                shippingNote.innerHTML = `
                    <i class="fas fa-shipping-fast"></i>
                    <strong>Ph√≠ ship: ${fee.toLocaleString('vi-VN')}ƒë</strong>
                    ${serviceName ? `<small>(${serviceName})</small>` : ''}
                    ${deliveryTime ? `<small>D·ª± ki·∫øn: ${deliveryTime}</small>` : ''}
                `;
                shippingNote.style.background = 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)';
                shippingNote.style.color = '#166534';
                shippingNote.style.padding = '12px';
                shippingNote.style.borderRadius = '8px';
            } else {
                // M·∫∑c ƒë·ªãnh
                shippingNote.innerHTML = '<i class="fas fa-truck"></i> Ph√≠ ship t√≠nh theo ƒë∆°n v·ªã v·∫≠n chuy·ªÉn';
                shippingNote.style.background = '';
                shippingNote.style.color = '';
                shippingNote.style.padding = '';
                shippingNote.style.borderRadius = '';
            }
        }

        // Load districts cho modal
        // Load districts cho modal
        async function loadDistrictsModal(provinceCode) {
            try {
                console.log('üîÑ ƒêang load huy·ªán cho t·ªânh:', provinceCode);
                const response = await fetch(PROVINCES_API + `p/${provinceCode}?depth=2`);
                const data = await response.json();
                
                console.log('üì¶ D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c:', data);
                
                const districtSelect = document.getElementById('modalDistrict');
                const wardSelect = document.getElementById('modalWard');
                
                districtSelect.innerHTML = '<option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>';
                wardSelect.innerHTML = '<option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>';
                wardSelect.disabled = true;
                
                if (data.districts && data.districts.length > 0) {
                    data.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.code;
                        option.textContent = district.name;
                        districtSelect.appendChild(option);
                    });
                    
                    districtSelect.disabled = false;
                    console.log('‚úÖ ƒê√£ load', data.districts.length, 'qu·∫≠n/huy·ªán');
                } else {
                    console.warn('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu qu·∫≠n/huy·ªán');
                }
            } catch (error) {
                console.error('‚ùå Error loading districts:', error);
            }
        }

        // Load wards cho modal
        async function loadWardsModal(districtCode) {
            try {
                console.log('üîÑ ƒêang load x√£ cho huy·ªán:', districtCode);
                const response = await fetch(PROVINCES_API + `d/${districtCode}?depth=2`);
                const data = await response.json();
                
                console.log('üì¶ D·ªØ li·ªáu x√£ nh·∫≠n ƒë∆∞·ª£c:', data);
                
                const wardSelect = document.getElementById('modalWard');
                wardSelect.innerHTML = '<option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>';
                
                if (data.wards && data.wards.length > 0) {
                    data.wards.forEach(ward => {
                        const option = document.createElement('option');
                        option.value = ward.code;
                        option.textContent = ward.name;
                        wardSelect.appendChild(option);
                    });
                    
                    wardSelect.disabled = false;
                    console.log('‚úÖ ƒê√£ load', data.wards.length, 'ph∆∞·ªùng/x√£');
                } else {
                    console.warn('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ph∆∞·ªùng/x√£');
                }
            } catch (error) {
                console.error('‚ùå Error loading wards:', error);
            }
        }

        function getCurrentPrice() {
            const selectedOption = document.querySelector('input[name="productType"]:checked');
            return parseInt(selectedOption.getAttribute('data-price'));
        }

        function updatePrice() {
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('active-opt');
                item.style.borderColor = '#e2e8f0';
                item.style.backgroundColor = '#fff';
            });
            
            const selectedRadio = document.querySelector('input[name="productType"]:checked');
            if(selectedRadio) {
                const parent = selectedRadio.parentElement;
                parent.classList.add('active-opt');
                parent.style.borderColor = '#f97316';
                parent.style.backgroundColor = '#fff7ed';
            }
            
            calculateTotal();
            
            // N·∫øu ƒë√£ c√≥ ƒë·ªãa ch·ªâ, t√≠nh l·∫°i ph√≠ ship v·ªõi tr·ªçng l∆∞·ª£ng m·ªõi
            const fullAddress = document.getElementById('fullAddress').value;
            if (fullAddress) {
                loadShippingServicesAfterAddress();
            }
        }

        function updateQuantity(change) {
            let currentQty = parseInt(qtyInput.value);
            let newQty = currentQty + change;
            if (newQty < 1) newQty = 1;
            if (newQty > 100) newQty = 100;
            qtyInput.value = newQty;
            calculateTotal();
        }

        function calculateTotal() {
            let price = getCurrentPrice();
            let quantity = parseInt(qtyInput.value);
            let productTotal = price * quantity;
            
            // Hi·ªÉn th·ªã ti·ªÅn h√†ng
            document.getElementById('productPrice').textContent = productTotal.toLocaleString('vi-VN') + 'ƒë';
            
            // T√≠nh t·ªïng bao g·ªìm ph√≠ ship
            let shippingFeeAmount = 0;
            if (selectedService) {
                shippingFeeAmount = selectedService.price;
                document.getElementById('shippingFeeRow').style.display = 'flex';
                document.getElementById('shippingFee').textContent = shippingFeeAmount.toLocaleString('vi-VN') + 'ƒë';
            } else {
                document.getElementById('shippingFeeRow').style.display = 'none';
            }
            
            let total = productTotal + shippingFeeAmount;
            totalPriceEl.textContent = total.toLocaleString('vi-VN') + 'ƒë';
        }

        updatePrice();

        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="btn-text">ƒêANG G·ª¨I...</span>';

            const quantity = parseInt(qtyInput.value);
            const price = getCurrentPrice();
            const productTotal = quantity * price;
            const typeLabel = document.querySelector('input[name="productType"]:checked').value;
            const fullAddress = document.getElementById('fullAddress').value;
            
            // L·∫•y ph√≠ ship v√† t·ªïng ti·ªÅn
            let shippingFeeAmount = 0;
            let shippingServiceName = 'Ch∆∞a ch·ªçn';
            if (selectedService) {
                shippingFeeAmount = selectedService.price;
                shippingServiceName = selectedService.name;
            }
            const totalMoney = productTotal + shippingFeeAmount;

            const formData = {
                fullName: document.getElementById('fullName').value,
                phone: document.getElementById('phone').value,
                address: fullAddress,
                quantity: `${quantity} g√≥i (${typeLabel})`,
                productMoney: productTotal.toLocaleString('vi-VN') + 'ƒë',
                shippingFee: shippingFeeAmount.toLocaleString('vi-VN') + 'ƒë',
                shippingService: shippingServiceName,
                totalMoney: totalMoney.toLocaleString('vi-VN') + 'ƒë',
                timestamp: new Date().toLocaleString('vi-VN')
            };

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(formData)
                });

                showToast();
                orderForm.reset();
                document.querySelector('input[value="1kg"]').checked = true;
                qtyInput.value = 1;
                
                // Reset shipping
                selectedService = null;
                document.getElementById('shippingServicesGroup').style.display = 'none';
                document.getElementById('shippingFeeRow').style.display = 'none';
                document.getElementById('addressDisplay').value = '';
                document.getElementById('fullAddress').value = '';
                
                // Disable n√∫t ƒë·∫∑t h√†ng
                submitBtn.disabled = true;
                
                const shippingNote = document.getElementById('shippingNote');
                shippingNote.innerHTML = '<i class="fas fa-truck"></i> Vui l√≤ng ch·ªçn g√≥i v·∫≠n chuy·ªÉn ƒë·ªÉ t√≠nh t·ªïng ti·ªÅn';
                shippingNote.style.background = '';
                shippingNote.style.color = '';
                shippingNote.style.padding = '';
                shippingNote.style.borderRadius = '';
                
                updatePrice();

            } catch (error) {
                console.error('Error:', error);
                showToast(); 
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        });

        function showToast() {
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 6000);
        }

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            });
        });
    </script>
</body>
</html>
